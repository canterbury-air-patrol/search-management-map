{% load static %}
<!DOCTYPE html>
<html style="height: 100%">
    <head>
        <title>Search Map Recorder</title>
        <base href="/static/" />
        <script type="module" src="pretty.js"></script>
        <script type="text/javascript">
            csrftoken = "{{ csrf_token }}";
        </script>
        <script>

function errorHandler(error) {
    let msg = null;
    switch(error.code) {
        case error.PERMISSION_DENIED:
             msg = "No permision given to access location";
             break;
        case error.POSITION_UNAVAILABLE:
             msg = "Unable to get the current position";
             break;
        case error.TIMEOUT:
             msg = "Timed out getting position";
             break;
        default:
             msg = "Unknown error: " + error.code;
             break;
    }
    $("#error_label").text('Error');
    $("#error_text").text(msg);
}

function updatePosition(position) {
    let latitude = position.coords.latitude;
    let longitude = position.coords.longitude;
    let altitude = position.coords.altitude;
    let heading = position.coords.heading;

    let asset_name = $("#id_asset option:selected").text();
    let data = {
        lat: latitude,
        lon: longitude,
        alt: altitude,
        heading: heading,
    };

    $("#latitude").text(latitude);
    $("#longitude").text(longitude);
    $("#altitude").text(altitude);
    $("#header").text(heading);

    $.get('/data/assets/' + asset_name + '/position/add/', data);
}

function startRecording(){
    if (navigator.geolocation) {
        let options = {
            timeout:60000,
            enableHighAccuracy: true
        };
        let geoLoc = navigator.geolocation;
        var watchID = geoLoc.watchPosition(updatePosition, errorHandler, options);
    }
}
        </script>
    </head>
    <body>
        <form>
        <table>
            {{ form }}
        </table>
        </form>
        <button class="btn btn-primary" onClick="startRecording()">Record</button>
        <table>
            <tr><td id='error_label'></td><td id='error_text'></td></tr>
            <tr><td>Latitude</td><td>Longitude</td><td>Altitude</td><td>Heading</td></tr>
            <tr><td id='latitude'><td id='longitude'></td><td id='altitude'></td><td id='heading'></td></tr>
        </table>
    </body>
</html>
